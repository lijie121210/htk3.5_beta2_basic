#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <fcntl.h>
#include <dirent.h>
#include <sys/types.h>
#include <sys/stat.h>


#define BUFLEN 1024
#define BUFLON 4096

#define HMM "<BEGINHMM> \n \
	<NUMSTATES> 5 \n \
	<STATE> 2 \n \
	<MEAN> 39 \n \
		-9.216795e+00 -3.465033e+00 -6.423656e+00 -1.107353e+01 -8.423258e+00 -1.073858e+01 -1.108349e+01 -6.035468e+00 \
-3.409545e+00 -8.778076e+00 -3.299176e+00 -3.847632e+00 6.077811e+01 6.235573e-03 3.134236e-03 1.414692e-03 \
-1.294906e-03 -1.141914e-03 7.894422e-03 1.230384e-03 -1.131871e-02 -7.178210e-03 3.021877e-03 -3.145615e-03 \
1.560011e-03 -3.663981e-03 2.621886e-04 9.166773e-04 -9.825568e-04 3.241693e-04 -9.543909e-05 3.029770e-04 \
-2.851614e-04 -1.491298e-04 -1.783248e-04 3.785257e-05 -1.129361e-04 -7.989937e-05 -1.018534e-03 \n \
	<VARIANCE> 39 \n \
		7.976604e+01 6.152662e+01 5.051948e+01 1.004776e+02 7.295739e+01 6.231032e+01 6.819729e+01 8.804686e+01 \
6.706458e+01 6.915740e+01 4.922140e+01 3.300986e+01 1.361345e+02 2.828882e+00 2.092716e+00 2.188640e+00 \
3.775563e+00 3.180235e+00 3.489889e+00 3.719737e+00 3.584243e+00 3.369323e+00 3.542708e+00 2.975766e+00 \
2.330531e+00 3.532624e+00 4.004033e-01 3.152293e-01 3.553639e-01 5.475901e-01 5.268688e-01 6.105083e-01 \
6.450021e-01 6.068367e-01 5.813815e-01 6.023107e-01 5.249541e-01 4.289736e-01 4.651601e-01 \n \
	<GCONST> 1.320602e+02 \n \
	<STATE> 3 \n \
	<MEAN> 39 \n \
		-9.216795e+00 -3.465033e+00 -6.423656e+00 -1.107353e+01 -8.423258e+00 -1.073858e+01 -1.108349e+01 -6.035468e+00 \
-3.409545e+00 -8.778076e+00 -3.299176e+00 -3.847632e+00 6.077811e+01 6.235573e-03 3.134236e-03 1.414692e-03 \
-1.294906e-03 -1.141914e-03 7.894422e-03 1.230384e-03 -1.131871e-02 -7.178210e-03 3.021877e-03 -3.145615e-03 \
1.560011e-03 -3.663981e-03 2.621886e-04 9.166773e-04 -9.825568e-04 3.241693e-04 -9.543909e-05 3.029770e-04 \
-2.851614e-04 -1.491298e-04 -1.783248e-04 3.785257e-05 -1.129361e-04 -7.989937e-05 -1.018534e-03 \n \
	<VARIANCE> 39 \n \
		7.976604e+01 6.152662e+01 5.051948e+01 1.004776e+02 7.295739e+01 6.231032e+01 6.819729e+01 8.804686e+01 \
6.706458e+01 6.915740e+01 4.922140e+01 3.300986e+01 1.361345e+02 2.828882e+00 2.092716e+00 2.188640e+00 \
3.775563e+00 3.180235e+00 3.489889e+00 3.719737e+00 3.584243e+00 3.369323e+00 3.542708e+00 2.975766e+00 \
2.330531e+00 3.532624e+00 4.004033e-01 3.152293e-01 3.553639e-01 5.475901e-01 5.268688e-01 6.105083e-01 \
6.450021e-01 6.068367e-01 5.813815e-01 6.023107e-01 5.249541e-01 4.289736e-01 4.651601e-01 \n \
	<GCONST> 1.320602e+02 \n \
	<STATE> 4 \n \
	<MEAN> 39 \n \
		-9.216795e+00 -3.465033e+00 -6.423656e+00 -1.107353e+01 -8.423258e+00 -1.073858e+01 -1.108349e+01 -6.035468e+00 \
-3.409545e+00 -8.778076e+00 -3.299176e+00 -3.847632e+00 6.077811e+01 6.235573e-03 3.134236e-03 1.414692e-03 \
-1.294906e-03 -1.141914e-03 7.894422e-03 1.230384e-03 -1.131871e-02 -7.178210e-03 3.021877e-03 -3.145615e-03 \
1.560011e-03 -3.663981e-03 2.621886e-04 9.166773e-04 -9.825568e-04 3.241693e-04 -9.543909e-05 3.029770e-04 \
-2.851614e-04 -1.491298e-04 -1.783248e-04 3.785257e-05 -1.129361e-04 -7.989937e-05 -1.018534e-03 \n \
	<VARIANCE> 39 \n \
		7.976604e+01 6.152662e+01 5.051948e+01 1.004776e+02 7.295739e+01 6.231032e+01 6.819729e+01 8.804686e+01 \
6.706458e+01 6.915740e+01 4.922140e+01 3.300986e+01 1.361345e+02 2.828882e+00 2.092716e+00 2.188640e+00 \
3.775563e+00 3.180235e+00 3.489889e+00 3.719737e+00 3.584243e+00 3.369323e+00 3.542708e+00 2.975766e+00 \
2.330531e+00 3.532624e+00 4.004033e-01 3.152293e-01 3.553639e-01 5.475901e-01 5.268688e-01 6.105083e-01 \
6.450021e-01 6.068367e-01 5.813815e-01 6.023107e-01 5.249541e-01 4.289736e-01 4.651601e-01 \n \
	<GCONST> 1.320602e+02 \n \
	<TRANSP> 5 \n \
		0.000000e+00 1.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 \n \
	    0.000000e+00 6.000000e-01 4.000000e-01 0.000000e+00 0.000000e+00 \n \
		0.000000e+00 0.000000e+00 6.000000e-01 4.000000e-01 0.000000e+00 \n \
		0.000000e+00 0.000000e+00 0.000000e+00 7.000000e-01 3.000000e-01 \n \
		0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 0.000000e+00 \n \
<ENDHMM> "

#define INPATH "/home/ylice/Desktop/htk3.5_beta2_repo/tutorialExample/monophones1"

int main(int argc, const char *argv[]) {

	//if (argc != ) {
	//	printf("Parameter error!");
	//}

	char fbuf[BUFLON+1];
	char phobuf[BUFLEN+1];
	FILE *fd;
	FILE *fin;
	int i;
	// first is file count
	//strcpy(fcount, argv[1]);

	// 2. file type: S or T
	//strcpy(fprefix, argv[2]);

	fd = fopen( "./hmmdefs", "w" );
	if (fd == (FILE *)NULL) {
		printf("fail to create file\n");
	}
	fin = fopen(INPATH, "r");
	if (fin == (FILE *)NULL) {
		printf("fail to read file\n");
	}
	
	while ( fgets(phobuf, BUFLEN, fin) ) {
		i = 0;
		while (phobuf[i] != '\0') { 
			if (phobuf[i] == '\n') {
				phobuf[i] = '\0';
				break;
			} else {
				++i;
			}
		}

		if (strcmp(phobuf, "sp") == 0) {
			continue;
		}

		snprintf(fbuf, BUFLON, "~h \"%s\"\n%s\n", phobuf, HMM);

		fputs(fbuf, fd);

		printf("writing %s\n", phobuf);
	}

	fclose(fd);
	fclose(fin);


	return 0;
}
